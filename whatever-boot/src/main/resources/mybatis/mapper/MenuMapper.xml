<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="me.weix.whatever.mapper.MenuMapper">

        <!-- 通用查询映射结果 -->
        <resultMap id="BaseResultMap" type="me.weix.whatever.entity.Menu">
            <id column="id" property="id"/>
            <result column="pid" property="pid"/>
            <result column="name" property="name"/>
            <result column="kind" property="kind"/>
            <result column="url" property="url"/>
            <result column="icon" property="icon"/>
            <result column="sort_no" property="sortNo"/>
            <result column="level" property="level"/>
            <result column="desc" property="desc"/>
            <result column="kind" property="kind"/>
            <result column="create_by" property="createBy"/>
            <result column="create_time" property="createTime"/>
            <result column="update_by" property="updateBy"/>
            <result column="update_time" property="updateTime"/>
            <result column="status" property="status"/>
            <result column="deleted" property="deleted"/>
        </resultMap>

        <!-- 通用查询结果列 -->
        <sql id="Base_Column_List">
            id, pid, name, kind, url, icon, sort_no AS sortNo, level, desc,
            create_by, create_time, update_by, update_time, status, deleted
        </sql>

    <select id="menuTreeList" resultType="me.weix.whatever.model.TreeNode">
        SELECT
        m1.id AS id,
        (
        CASE
        WHEN (m2.id = 0 OR m2.id IS NULL) THEN
        0
        ELSE
        m2.id
        END
        ) AS pId,
        m1.name
        AS name,
        (
        CASE
        WHEN (m2.id = 0 OR m2.id IS NULL) THEN
        'true'
        ELSE
        'false'
        END
        ) as open
        FROM
        t_menu m1
        LEFT join t_menu m2 ON m1.pid = m2.id
        ORDER BY
        m1.id ASC
    </select>


    <select id="getMenusByRoleIds" resultMap="BaseResultMap">
        select m.*
        from t_menu m
        left join t_role_menu rm on m.id = rm.menu_id
        where rm.role_id in
        <foreach collection="roleIds" index="index" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </select>
</mapper>
